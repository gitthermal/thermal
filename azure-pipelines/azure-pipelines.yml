variables:
  system.debug: true

jobs:
  - job: win
    displayName: Windows
    pool:
      vmImage: "vs2017-win2016"

    strategy:
      matrix:
        node_8_x:
          node_version: ">=8.12.x"
        node_10_x:
          node_version: "10.x"

    steps:
      - template: win.yml

  - job: linux
    displayName: Linux
    pool:
      vmImage: "ubuntu-16.04"

    strategy:
      matrix:
        node_8_x:
          node_version: ">=8.12.x"
        node_10_x:
          node_version: "10.x"

    steps:
      - template: linux.yml

  - job: mac
    displayName: MacOS
    pool:
      vmImage: "macos-10.13"

    strategy:
      matrix:
        node_8_x:
          node_version: ">=8.12.x"
        node_10_x:
          node_version: "10.x"

    steps:
      - template: mac.yml

  - job: github_releases
    dependsOn: |
      win
      linux
      mac
    condition: succeeded()
    steps:
      - script: |
          echo Name
          echo $(Build.Repository.Name)
          echo Source Version
          echo $(Build.SourceVersion)
          echo Artifact Staging Directory
          echo $(Build.ArtifactStagingDirectory)/*
      - task: GitHubRelease@0
        displayName: "Create GitHub Release"
        inputs:
          gitHubConnection: thermal
          repositoryName: $(Build.Repository.Name)
          action: 'create'
          # Required when action == Create || Action == Edit
          target: $(Build.SourceVersion)
          # Required when action == Create
          # Options: auto, manual
          tagSource: 'auto'
          assets: $(Build.ArtifactStagingDirectory)/*
          isDraft: true
          addChangeLog: true
